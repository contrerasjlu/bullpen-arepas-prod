{% extends 'website/template.html' %}
{% block WindowTittle %}Menu{% endblock %}
{% block Content %}
{% load staticfiles %}
{% load widget_tweaks %}
<div class="right_col" role="main">
    <div class="">
        <div class="clearfix"></div>
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>{{product.name}} <small>{{product.description}}</small></h2>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <a href="{% url 'website:menu' %}">
                            <button type="button" class="btn btn-warning"><i class="glyphicon glyphicon-chevron-left"></i>Back to Menu</button>
                        </a>
                        <div class="clearfix"></div>
                        <!-- Tabs -->
                        <form method="post" id="arepa_form" action="">
                        {% csrf_token %}
                        {{ form.non_field_errors }}
                        <div id="wizard" class="form_wizard wizard_horizontal">
                            <ul class="list-unstyled wizard_steps">
                                <li>
                                    <a href="#step-11">
                                        <span class="step_no">1</span>
                                        <span class="step_descr">Type of Arepa</span>
                                    </a>
                                </li>
                                {% if not product.extras == 0 %}
                                <li>
                                    <a href="#step-22">
                                        <span class="step_no">2</span>
                                        <span class="step_descr">Players<br /> 
                                        </span>
                                    </a>
                                </li>
                                {% endif %}
                                <li>
                                    <a href="#step-33">
                                        <span class="step_no">{% if product.extras == 0 %}2{% else %}3{% endif %}</span>
                                        <span class="step_descr">On the Bench</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#step-44">
                                        <span class="step_no">{% if product.extras == 0 %}3{% else %}4{% endif %}</span>
                                        <span class="step_descr">Sauces</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#step-55">
                                        <span class="step_no">{% if product.extras == 0 %}4{% else %}5{% endif %}</span>
                                        <span class="step_descr">Drinks</span>
                                    </a>
                                </li>
                            </ul>
                            <div id="step-11">
                                <span class="section">We can Fry your Arepa or we can make it in the oven</span>
                                {{ form.id_for_product }}
                                <div class="form-inline">
                                    <div class="col-md-3 col-sm-3 col-xs-6">
                                        {{ form.arepa_type }}
                                    </div>
                                    {% if form.arepa_type.errors %}
                                    <div class="form-group has-error">
                                        <p class="control-label">{{ form.arepa_type.errors }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="clearfix"></div>
                                <br />
                                <span class="section">Vegetables?</span>
                                <div class="form-inline">
                                {% for field in form.vegetables %}
                                    <div class="col-md-3 col-sm-3  col-xs-6">
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                {% if form.vegetables.errors %}
                                    <div class="form-group has-error">
                                        <p class="control-label">{{ form.vegetables.errors }}</p>
                                    </div>
                                {% endif %}
                                </div>
                            </div>
                            {% if not product.extras == 0 %}
                            <div id="step-22">
                                <span class="section">You shuld choose {{ product.extras }} players for your Arepas</span>
                                <div class="form-group has-error">
                                    <p class="control-label" id="msj-error-arepa">Yo can only choose only {{ product.extras }} Player{% if product.extra > 1 %}s{% endif %}</p>
                                </div>
                                <div class="form-inline">
                                {% for field in form.extras %}
                                    <div class="col-md-3 col-sm-3  col-xs-6">
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                    {% if form.extras.errors %}
                                    <div class="form-group has-error">
                                        <p class="control-label">{{ form.extras.errors }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% else %}
                                <input type="hidden" value="{{ pabellon.id }}" name="extras" />
                            {% endif %}
                            <div id="step-33">
                                <span class="section">Choose as much players as you want for $0.99 each</span>
                                <div class="form-inline">
                                {% for field in form.paid_extras %}
                                    <div class="col-md-3 col-sm-3 col-xs-6">
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                    {% if form.paid_extras.errors %}
                                    <div class="form-group has-error">
                                        <p class="control-label">{{ form.paid_extras.errors }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div id="step-44">
                                <span class="section">Choose as much as you want NO CHARGE!</span>
                                <div class="form-inline">
                                {% for field in form.sauces %}
                                    <div class="col-md-3 col-sm-3 col-xs-6">
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                    {% if form.sauces.errors %}
                                    <div class="form-group has-error">
                                    {% for error in form.sauces.errors %}
                                        <p class="control-label">{{ error }}</p>
                                    {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div id="step-55">
                                <span class="section">Just $1.00</span>
                                <div class="form-group">
                                {% for field in form.soft_drinks %}
                                    <label>{{ field.label }}</label>
                                        <div class="col-md-3 col-sm-3">
                                            {{ field }}
                                        </div>
                                        {% if form.soft_drinks.errors %}
                                        <div class="form-group has-error">
                                        {% for error in form.soft_drinks.errors %}
                                            <p class="control-label">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                </div>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}      
{% block FooterDeclarations %}
    <script type="text/javascript" src="{% static 'website/v2/js/wizard/jquery.smartWizard.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#msj-error-arepa").hide();
            // Smart Wizard	
            $('#wizard').smartWizard({
                transitionEffect: 'fade',
                labelFinish: 'Add to Cart',
                onLeaveStep: leaveAStepCallback,
                onFinish: onFinishCallback
            });

            function leaveAStepCallback(obj, context){
                //alert("Leaving step " + context.fromStep + " to go to step " + context.toStep);
                return validateSteps(context.fromStep); // return false to stay on step and true to continue navigation 
            }

            function onFinishCallback(objs, context){
                if(validateAllSteps()){
                    $('#arepa_form').submit();
                }
            }

            // Your Step validation logic
            function validateSteps(stepnumber){
                var isStepValid = true;
                var extras_count = 0;
                //var max_extras = {{ product.extras }};
                // validate step 1
                {% if not product.extras == 0 %}
                if(stepnumber == 2){
                    //recorremos todos los checkbox seleccionados con .each
                    $('input[name="extras"]:checked').each(function() {
                        extras_count ++;
                    });

                    if (extras_count == {{product.extras}}) {
                        isStepValid = true
                    
                    }else {
                        isStepValid = false;
                        $("#msj-error-arepa").show();
                    }
                }else {
                    isStepValid = true;
                    $("#msj-error-arepa").hide();
                }
                {% endif %}
                return isStepValid
            }
            
            function validateAllSteps(){
                var isStepValid = true;
                // all step validation logic     
                return isStepValid;
            }          
        });
    </script>
{% endblock %}